<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZenWrite: Minimal Markdown Studio</title>

    <!-- Essential Libraries via CDN -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">

    <!-- KaTeX for Math Rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>

    <!-- PDF EXPORT (REINTRODUCED: Note: Client-side PDF via html2canvas is lower quality than native print) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <!-- Embedded CSS (Layout, Themes, and Print Optimization) -->
    <style>
        /* --- Root Variables (Default Light Theme) --- */
        :root {
            --bg-color: #f8f8f8;
            --text-color: #333;
            --header-bg: #404040;
            --header-text: #fff;
            --panel-border: #ddd;
            --editor-bg: #ffffff;
            --preview-bg: #ffffff;
            --code-bg: #f4f4f4;
            --link-color: #3498db;
            --editor-font: 'Consolas', 'Monospace';
            --font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            --status-bg: #333;
            --status-text: #fff;
        }

        /* --- Theme Definitions --- (Same as previous version, omitted for brevity but included in the code below) */
        .theme-dark { --bg-color: #222; --text-color: #ccc; --header-bg: #1c1c1c; --header-text: #fff; --panel-border: #444; --editor-bg: #282c34; --preview-bg: #1e1e1e; --code-bg: #2d313a; --link-color: #79a8e9; --status-bg: #111; }
        .theme-sepia { --bg-color: #f7f3e0; --text-color: #5b4636; --header-bg: #8d7b68; --header-text: #fff; --panel-border: #d4cbb8; --editor-bg: #fffbf0; --preview-bg: #fffbf0; --code-bg: #eee9dc; --font-family: 'Georgia', serif; --link-color: #2d6e9e; --status-bg: #5b4636; }
        .theme-academic { --bg-color: #ffffff; --text-color: #1a1a1a; --header-bg: #003366; --header-text: #fff; --panel-border: #a1b2c4; --editor-bg: #ffffff; --preview-bg: #ffffff; --code-bg: #e6f0ff; --font-family: 'Times New Roman', serif; --link-color: #0056b3; --status-bg: #003366; }
        .theme-minimal { --bg-color: #ffffff; --text-color: #111; --header-bg: #f0f0f0; --header-text: #333; --panel-border: #eee; --editor-bg: #ffffff; --preview-bg: #ffffff; --code-bg: #f8f8f8; --link-color: #000000; --status-bg: #f0f0f0; --status-text: #333; }
        .theme-ocean { --bg-color: #e0f7fa; --text-color: #004d40; --header-bg: #00bcd4; --header-text: #fff; --panel-border: #b2ebf2; --editor-bg: #ffffff; --preview-bg: #ffffff; --code-bg: #b2ebf2; --link-color: #0097a7; --status-bg: #0097a7; }
        .theme-terminal { --bg-color: #000000; --text-color: #00ff00; --header-bg: #0a0a0a; --header-text: #00ff00; --panel-border: #003300; --editor-bg: #000000; --preview-bg: #000000; --code-bg: #111; --link-color: #00ffff; --editor-font: 'Monospace', 'Courier New'; --status-bg: #000; }
        .theme-highcontrast { --bg-color: #ffffff; --text-color: #000000; --header-bg: #000000; --header-text: #ffffff; --panel-border: #000000; --editor-bg: #ffffff; --preview-bg: #ffffff; --code-bg: #e0e0e0; --link-color: #0000ff; --status-bg: #000; }
        .theme-solarized { --bg-color: #fdf6e3; --text-color: #586e75; --header-bg: #eee8d5; --header-text: #586e75; --panel-border: #eee8d5; --editor-bg: #fdf6e3; --preview-bg: #fdf6e3; --code-bg: #eee8d5; --link-color: #268bd2; --status-bg: #eee8d5; --status-text: #586e75; }
        .theme-solarized-dark { --bg-color: #002b36; --text-color: #839496; --header-bg: #073642; --header-text: #839496; --panel-border: #073642; --editor-bg: #002b36; --preview-bg: #002b36; --code-bg: #073642; --link-color: #268bd2; --status-bg: #073642; }
        .theme-newspaper { --bg-color: #fcfcf4; --text-color: #1a1a1a; --header-bg: #222; --header-text: #fff; --panel-border: #aaa; --editor-bg: #ffffff; --preview-bg: #ffffff; --code-bg: #f0f0f0; --font-family: 'Lora', serif; --link-color: #800000; --status-bg: #222; }

        /* --- Global Layout and Controls --- */
        body { display: flex; flex-direction: column; margin: 0; height: 100vh; font-family: var(--font-family); background-color: var(--bg-color); color: var(--text-color); line-height: 1.6; }
        header { background-color: var(--header-bg); color: var(--header-text); padding: 8px 15px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2); flex-shrink: 0; }
        
        /* Dropdown/Button Styling */
        header select, header button { padding: 5px 10px; margin-left: 10px; border: none; border-radius: 3px; cursor: pointer; background-color: rgba(255, 255, 255, 0.15); color: var(--header-text); transition: background-color 0.1s; }
        header button:hover, header select:hover { background-color: rgba(255, 255, 255, 0.3); }
        header select { color: #333; background-color: #fff; }
        header select option { background-color: #fff; color: #333; }
        
        /* File Name Input */
        #file-name-input { 
            border: none; 
            background: transparent; 
            color: var(--header-text); 
            font-weight: bold; 
            font-size: 18px;
            margin-left: 10px;
            padding: 2px 5px;
            width: 250px;
        }
        
        /* PDF Status Indicator */
        #pdf-status { color: #ffeb3b; margin-left: 15px; font-weight: bold; }

        /* Main Split View */
        main { display: flex; flex-grow: 1; overflow: hidden; }
        .panel { flex: 1; padding: 15px; overflow-y: scroll; box-sizing: border-box; height: 100%; position: relative; } 

        /* Editor/Preview Styles */
        #editor-container { border-right: 1px solid var(--panel-border); background-color: var(--editor-bg); }
        #editor { width: 100%; height: 100%; border: none; resize: none; font-family: var(--editor-font); font-size: 15px; line-height: 1.6; outline: none; padding: 0; background-color: var(--editor-bg); color: var(--text-color); }
        #preview { background-color: var(--preview-bg); }
        #preview h1, #preview h2 { color: var(--link-color); border-bottom: 1px solid var(--panel-border); padding-bottom: 5px; margin-top: 1.5em; }
        #preview pre { background-color: var(--code-bg); padding: 10px; border-radius: 4px; overflow-x: auto; }
        #preview blockquote { border-left: 5px solid var(--link-color); padding-left: 15px; margin: 15px 0; opacity: 0.85; font-style: italic; }
        #preview table { width: 100%; border-collapse: collapse; margin: 1em 0; }
        #preview th, #preview td { border: 1px solid var(--panel-border); padding: 8px 12px; text-align: left; }
        .katex { color: var(--text-color); }

        /* Status Bar */
        #status-bar {
            background-color: var(--status-bg);
            color: var(--status-text);
            padding: 5px 15px;
            font-size: 12px;
            display: flex;
            justify-content: flex-end;
            gap: 20px;
            flex-shrink: 0;
        }
        
        /* --- PRINT CSS (Hidden as PDF is now html2canvas-based, but kept for potential future use) --- */
        @media print {
            header, #editor-container, #status-bar, .controls, #pdf-status { display: none !important; }
            body, main { display: block !important; height: auto; margin: 0; padding: 0; background-color: #fff; color: #000; }
            .panel { flex: none !important; width: 100% !important; overflow: visible !important; box-sizing: border-box; padding: 1cm; }
            #preview table, #preview pre, #preview img { page-break-inside: avoid; }
            * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
        }
    </style>
</head>
<body>

    <header>
        <div>
            ZenWrite: 
            <input type="text" id="file-name-input" value="My New Document">
        </div>
        <div class="controls">
            <!-- Theme Selection -->
            <select id="theme-select" onchange="applyTheme(this.value)">
                <option value="default">1. Default Light</option>
                <option value="dark">2. Dark Mode</option>
                <option value="sepia">3. Sepia Book</option>
                <option value="academic">4. Academic Paper</option>
                <option value="minimal">5. Minimal White</option>
                <option value="ocean">6. Ocean Blue</option>
                <option value="terminal">7. Green Terminal</option>
                <option value="highcontrast">8. High Contrast</option>
                <option value="solarized">9. Solarized Light</option>
                <option value="solarized-dark">10. Solarized Dark</option>
            </select>

            <!-- Export Button (PDF option restored to use html2canvas) -->
            <select id="export-select" onchange="handleExport(this.value)">
                <option value="" disabled selected>Export (8 Formats)</option>
                <option value="pdf">PDF (Image Based)</option>
                <option value="md">Markdown (.md)</option>
                <option value="html">HTML (.html)</option>
                <option value="txt">Plain Text (.txt)</option>
                <option value="csv">CSV (Table Extract)</option>
                <option value="json">JSON (As Object)</option>
                <option value="xml">XML (As Tagged Text)</option>
                <option value="yaml">YAML (As Key/Value)</option>
            </select>
            <span id="pdf-status"></span>

            <!-- Import Button -->
            <input type="file" id="file-upload" style="display: none;" onchange="handleImport(event)">
            <button onclick="document.getElementById('file-upload').click()">Import File</button>
        </div>
    </header>

    <main>
        <!-- Editor Panel -->
        <div class="panel" id="editor-container">
            <textarea id="editor"></textarea>
        </div>

        <!-- Preview Panel -->
        <div class="panel" id="preview">
            <!-- Content injected by JavaScript -->
        </div>
    </main>
    
    <!-- Status Bar -->
    <footer id="status-bar">
        <span id="char-count">Characters: 0</span>
        <span id="word-count">Words: 0</span>
        <span id="line-count">Lines: 0</span>
    </footer>

    <!-- Embedded JavaScript -->
    <script>
        const editor = document.getElementById('editor');
        const editorContainer = document.getElementById('editor-container');
        const preview = document.getElementById('preview');
        const fileNameInput = document.getElementById('file-name-input');
        const pdfStatus = document.getElementById('pdf-status');
        
        const STORAGE_KEY = 'zenwrite_content';
        const FILENAME_KEY = 'zenwrite_filename';
        const THEME_KEY = 'zenwrite_theme';
        
        // Flags for refined bidirectional scroll sync
        let isSyncingEditor = false;
        let isSyncingPreview = false;
        
        // --- Initial Markdown Template ---
        const WELCOME_TEMPLATE = `# Welcome to ZenWrite: Your Minimal Markdown Studio

Start writing clean, structured documents instantly. ZenWrite provides a powerful, distraction-free environment with professional output capabilities.

## âœ¨ Core Features at a Glance

### 1. Real-Time, Bidirectional Sync

Type on the left, see the result instantly on the right. Scroll either panel, and the other will track perfectly:

> This seamless synchronization ensures you always see exactly what your final output will look like.

### 2. Professional Export Quality

Export your content in high-quality formats suitable for production:

*   **High Quality PDF:** Export via native print for perfect, vector-based text and intelligent page breaks.
*   **Structured Data:** Extract your content as **JSON, YAML,** or **XML**.
*   **Source:** Download your raw **Markdown (.md)** or **Plain Text (.txt)** files.

### 3. Integrated Math and Code Support

ZenWrite is built for technical documentation, supporting syntax highlighting and complex mathematical notation.

#### Code Highlighting Example (Python)

<pre>
def check_document_status(lines, words, chars):
    """Calculates status metrics in real-time."""
    if words > 500:
        return "Draft Ready"
    else:
        return "In Progress"

print(check_document_status(10, 150, 800))
</pre>

#### Mathematical Notation (KaTeX)

You can write complex equations like the Fourier Series expansion $f(x) = \sum_{n=-\infty}^\infty c_n e^{i n x}$ or display them centered:

$$
\int_{0}^{\pi} \sin^2(x) dx = \frac{\pi}{2}
$$

### 4. Structure and Theming

Use headers, lists, and tables to organize your thoughts:

| Component | Status | Theme Support |
| :--- | :--- | :--- |
| Editor | Live Input | Yes (10 options) |
| Preview | Real-Time | Yes (10 options) |
| Status Bar | Active | Yes |

*   Experiment with the **Theme Selector** in the top bar to find your perfect writing environment.
*   The footer shows **live counts** of your characters, words, and lines.

Enjoy writing!
`;
        
        // --- Marked & KaTeX Configuration ---
        
        marked.setOptions({
            renderer: new marked.Renderer(),
            highlight: (code, lang) => {
                const language = hljs.getLanguage(lang) ? lang : 'plaintext';
                return hljs.highlight(code, { language }).value;
            },
            gfm: true,
            breaks: true,
            sanitize: true,
        });

        // --- Core Functions ---

        function updatePreview() {
            const markdown = editor.value;
            const html = marked.parse(markdown);
            
            preview.innerHTML = html;

            // Render KaTeX
            if (window.renderMathInElement) {
                renderMathInElement(preview, {
                    delimiters: [
                        { left: '$$', right: '$$', display: true },
                        { left: '$', right: '$', display: false },
                    ],
                    throwOnError: false
                });
            }
            
            updateStatus(markdown);
            saveContent();
        }

        function updateStatus(markdown) {
            const lines = markdown.split('\n').length;
            const words = markdown.trim().split(/\s+/).filter(w => w.length > 0).length;
            const chars = markdown.length;

            document.getElementById('char-count').textContent = `Characters: ${chars}`;
            document.getElementById('word-count').textContent = `Words: ${words}`;
            document.getElementById('line-count').textContent = `Lines: ${lines}`;
        }

        function saveContent() {
            localStorage.setItem(STORAGE_KEY, editor.value);
            localStorage.setItem(FILENAME_KEY, fileNameInput.value);
        }

        function applyTheme(themeName) {
            document.body.className = ''; 
            if (themeName !== 'default') {
                document.body.classList.add(`theme-${themeName}`);
            }
            localStorage.setItem(THEME_KEY, themeName);
            updatePreview(); 
        }

        // --- REFINED BIDIRECTIONAL SCROLL SYNCHRONIZATION V5 ---

        function syncScroll(source, target, isSourceEditor) {
            if (isSourceEditor) {
                if (isSyncingPreview) return;
                isSyncingEditor = true;
            } else {
                if (isSyncingEditor) return;
                isSyncingPreview = true;
            }

            const sourceScrollableHeight = source.scrollHeight - source.clientHeight;
            const targetScrollableHeight = target.scrollHeight - target.clientHeight;
            
            if (sourceScrollableHeight <= 0 || targetScrollableHeight <= 0) {
                if (isSourceEditor) isSyncingEditor = false;
                else isSyncingPreview = false;
                return;
            }

            const percentage = source.scrollTop / sourceScrollableHeight;
            target.scrollTop = percentage * targetScrollableHeight;
            
            // Clear flags after a short, optimized delay (30ms)
            setTimeout(() => { 
                if (isSourceEditor) isSyncingEditor = false;
                else isSyncingPreview = false;
            }, 30); 
        }

        // --- File I/O Functions ---

        function handleImport(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                editor.value = e.target.result;
                fileNameInput.value = file.name.replace(/\.[^/.]+$/, "");
                updatePreview();
            };
            reader.readAsText(file);
        }

        function handleExport(format) {
            let filename = fileNameInput.value.trim() || "zenwrite_document";
            
            document.getElementById('export-select').value = ""; // Reset dropdown

            switch (format) {
                case 'pdf':
                    pdfStatus.textContent = "Processing PDF (takes time)...";
                    // Delay to ensure status update is visible
                    setTimeout(() => exportToPDF(filename), 50);
                    break;
                case 'md':
                case 'txt':
                case 'csv':
                case 'json':
                case 'xml':
                case 'yaml':
                case 'html':
                    exportTextFile(format, filename);
                    break;
            }
        }
        
        function exportTextFile(format, filename) {
            const content = editor.value;
            let exportData = content;
            let mimeType = 'text/plain';

            switch (format) {
                case 'md':
                    mimeType = 'text/markdown';
                    break;
                case 'csv':
                    mimeType = 'text/csv';
                    break;
                case 'json':
                    exportData = JSON.stringify({ filename: filename, markdown: content }, null, 2);
                    mimeType = 'application/json';
                    break;
                case 'xml':
                    exportData = `<document title="${filename}"><markdown><![CDATA[${content}]]></markdown></document>`;
                    mimeType = 'application/xml';
                    break;
                case 'yaml':
                    exportData = `filename: ${filename}\nmarkdown_content: | \n  ${content.replace(/\n/g, '\n  ')}`;
                    mimeType = 'application/x-yaml';
                    break;
                case 'html':
                    // Generates standalone HTML file of the rendered preview
                    const styleContent = document.querySelector('style').innerHTML;
                    exportData = `<!DOCTYPE html><html><head><title>${filename}</title><style>${styleContent}</style></head><body class="${document.body.className}" style="margin: 20px;">${preview.innerHTML}</body></html>`;
                    mimeType = 'text/html';
                    break;
            }
            downloadFile(`${filename}.${format}`, exportData, mimeType);
        }


        function downloadFile(filename, data, mimeType) {
            const blob = new Blob([data], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // --- PDF Generation with html2canvas (Image-Based) ---
        function exportToPDF(filename) {
            const { jsPDF } = window.jspdf;
            const html2canvas = window.html2canvas;

            if (!jsPDF || !html2canvas) {
                pdfStatus.textContent = "Error: PDF library missing.";
                console.error("PDF Generation Error: Required libraries failed to load.");
                return;
            }
            
            const doc = new jsPDF('p', 'pt', 'a4');
            const element = preview; 

            // Use the full width of the rendered content, not the viewport width
            const printWidth = element.scrollWidth > 580 ? element.scrollWidth : 580;

            doc.html(element, {
                callback: function (doc) {
                    doc.save(`${filename}.pdf`);
                    pdfStatus.textContent = "PDF Ready!";
                    setTimeout(() => pdfStatus.textContent = "", 2000); // Clear status
                },
                x: 10,
                y: 10,
                html2canvas: {
                    scale: 0.6, // Adjusted scale for balance between size and quality
                    logging: false,
                    useCORS: true
                },
                windowWidth: printWidth,
                width: 580 // A4 size approximation
            }).catch(error => {
                pdfStatus.textContent = "PDF Error!";
                console.error("PDF Generation failed:", error);
                setTimeout(() => pdfStatus.textContent = "", 2000);
            });
        }


        // --- Initialization ---

        function initializeApp() {
            // 1. Load content
            const savedContent = localStorage.getItem(STORAGE_KEY);
            editor.value = savedContent !== null ? savedContent : WELCOME_TEMPLATE;
            
            // 2. Load filename
            const savedFilename = localStorage.getItem(FILENAME_KEY);
            if (savedFilename) {
                fileNameInput.value = savedFilename;
            }

            // 3. Load theme
            const savedTheme = localStorage.getItem(THEME_KEY) || 'default';
            const themeSelect = document.getElementById('theme-select');
            if (themeSelect.querySelector(`option[value="${savedTheme}"]`)) {
                themeSelect.value = savedTheme;
            }
            applyTheme(themeSelect.value); // Initial preview update is inside applyTheme

            // 4. Setup Real-time input listener (FIXED)
            editor.addEventListener('input', updatePreview);

            // 5. Set up event listeners for scroll sync
            editorContainer.addEventListener('scroll', () => syncScroll(editorContainer, preview, true));
            preview.addEventListener('scroll', () => syncScroll(preview, editorContainer, false));

        }

        initializeApp();
    </script>

</body>
</html>

-----------------------------------------------------

do the following : 
Removed jsPDF and html2canvas dependencies. The export option is renamed to "High Quality PDF (via Print)".
Remove the theme numbering that is there in the theme dropdown. Add more at all the possible markdown editor controls. And I need more precise action tracking in the website. And yeah, I want this website to be able to render any kind of markdown without mistake, with full accuracy and in a completely beautiful manner. I want fully customizability in this website. I want this markdown editor to be optimum and have all the settings or features that a markdown editor should have in it, included. And I want an option there to choose from various types of fonts as well, and colors as well.
send me the full copy paste ready code for me to test.